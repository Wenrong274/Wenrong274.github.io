<?xml version="1.0" encoding="utf-8" standalone="yes"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom" xmlns:content="http://purl.org/rss/1.0/modules/content/">
  <channel>
    <title>tool on Wenrong&#39;s Note</title>
    <link>https://wenrongdev.com/tags/tool/</link>
    <description>Recent content in tool on Wenrong&#39;s Note</description>
    <generator>Hugo -- gohugo.io</generator>
    <language>zh</language>
    <lastBuildDate>Fri, 20 Oct 2023 00:00:00 +0000</lastBuildDate><atom:link href="https://wenrongdev.com/tags/tool/index.xml" rel="self" type="application/rss+xml" />
    <item>
      <title>Wix Examples</title>
      <link>https://wenrongdev.com/posts/wixexamples/</link>
      <pubDate>Fri, 20 Oct 2023 00:00:00 +0000</pubDate>
      
      <guid>https://wenrongdev.com/posts/wixexamples/</guid>
      <description>主要是用來打包程式輸出成 .msi 檔</description>
      <content:encoded><![CDATA[<p>主要是用來打包程式輸出成 <code>.msi</code> 檔（<a href="https://zh.wikipedia.org/zh-tw/Windows_Installer">Windows Installer</a>）。</p>
<p>建議先看完 「<a href="https://ithelp.ithome.com.tw/users/20139206/ironman/3901">30 天 | C# WixToolset + WPF 帥到不行的安裝包 系列</a>」，能夠把 80% 以上的問題解決。</p>
<h3 id="輸出-wix-文件方法">輸出 Wix 文件方法</h3>
<p>先到 <a href="https://github.com/wixtoolset/wix3/releases">WiX Toolset Release</a> 安裝需要的工具。</p>
<p>需要開啟 <a href="https://zh.wikipedia.org/zh-tw/cmd.exe">CMD</a> 且必須要用<code>工作管理員權限</code>打開，之後 cd 到 WiX Toolset 的安裝資料夾。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-text" data-lang="text">C:\Program Files (x86)\WiX Toolset v3.11\bin
</code></pre></div><p><img loading="lazy" src="https://i.imgur.com/ovuJCka.png" alt="img_1"  />
</p>
<h4 id="heatexe">heat.exe</h4>
<p>可以掃描目錄中的所有文件和子目錄，並生成 WiX 文件中所需的 Component、Directory、File 和其他元素的定義。</p>
<p>使用下面的參數可以拿到 <code>myKeyIn.wxs</code>。需要把 [MyDemo] 替換成正確的路徑，可以參考我的 <code>Product.wxs</code>。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-text" data-lang="text">heat.exe dir &#34;[PUT_YOUR_PATH]&#34; -dr INSTALLFOLDER -cg ProductComponents -gg -gl -sf -srd -var &#34;[MyDemo]&#34; -out &#34;[PUT_YOUR_OUTPUT_PATH]\myKeyIn.wxs&#34;
</code></pre></div><table>
<thead>
<tr>
<th style="text-align:left">參數名稱</th>
<th style="text-align:left">解釋</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">[PUT_YOUR_PATH]</td>
<td style="text-align:left">需要打包的路徑資料夾</td>
</tr>
<tr>
<td style="text-align:left">[MyDemo]</td>
<td style="text-align:left">WiX 文件中要使用的變數</td>
</tr>
<tr>
<td style="text-align:left">[PUT_YOUR_OUTPUT_PATH]</td>
<td style="text-align:left">WiX 文件的路徑</td>
</tr>
</tbody>
</table>
<p><img loading="lazy" src="https://i.imgur.com/SbjBwmv.png" alt="img_2"  />
</p>
<h2 id="wix-productwxs">Wix Product.wxs</h2>
<p><a href="https://raw.githubusercontent.com/Wenrong274/WixExamples/master/WixInstaller/WixToolset/Product.wxs">Product.wxs</a></p>
<h3 id="桌面捷徑">桌面捷徑</h3>
<p>需要注意一些細項設定，如 Guid、執行檔名稱、路徑等。</p>
<pre tabindex="0"><code class="language-wxc" data-lang="wxc">&lt;Directory Id=&quot;DesktopFolder&quot; Name=&quot;Desktop&quot; &gt;
    &lt;Component Id=&quot;DesktopFolderShortcut&quot; Guid=&quot;{94D38478-869E-4CA8-BEA6-7905A7135DB8}&quot;&gt;
        &lt;Shortcut Id=&quot;DesktopShortcut&quot; Directory=&quot;DesktopFolder&quot; Name=&quot;Wix-Hello Unity&quot; Target=&quot;[INSTALLFOLDER]Wix-Hello Unity.exe&quot; WorkingDirectory=&quot;INSTALLFOLDER&quot; Icon=&quot;WixToolsetIcon&quot;&gt;
        &lt;/Shortcut&gt;
        &lt;RegistryValue Root=&quot;HKCU&quot; Key=&quot;Software\WenRongStudio\Wix-Hello Unity&quot; Name=&quot;installed&quot; Type=&quot;integer&quot; Value=&quot;1&quot; KeyPath=&quot;yes&quot;/&gt;
    &lt;/Component&gt;
&lt;/Directory&gt;
</code></pre><h4 id="資料夾權限">資料夾權限</h4>
<p>避免安裝在系統槽時，無法變動檔案，所以必須把資料夾權限打開。</p>
<p>需要注意一些細項設定，如 Guid 等。</p>
<pre tabindex="0"><code class="language-wxc" data-lang="wxc">&lt;Component Id=&quot;InstallationDirectory&quot; Guid='{0D92D4B6-CACE-4556-8CBD-C8C385B22D28}' &gt;
    &lt;CreateFolder Directory=&quot;INSTALLFOLDER&quot;&gt;
        &lt;Permission User=&quot;SYSTEM&quot; GenericAll=&quot;yes&quot;/&gt;
        &lt;Permission User=&quot;EveryOne&quot; GenericAll=&quot;yes&quot; GenericRead=&quot;yes&quot; Read=&quot;yes&quot; ReadAttributes=&quot;yes&quot;  GenericExecute=&quot;yes&quot; TakeOwnership =&quot;yes&quot;  GenericWrite =&quot;yes&quot;    WriteAttributes=&quot;yes&quot; ReadPermission =&quot;yes&quot;   ChangePermission=&quot;yes&quot; /&gt;
        &lt;Permission User=&quot;Users&quot; Domain=&quot;[LOCAL_MACHINE_NAME]&quot; GenericAll=&quot;yes&quot; GenericRead=&quot;yes&quot; Read=&quot;yes&quot; ReadAttributes=&quot;yes&quot;  GenericExecute=&quot;yes&quot; TakeOwnership =&quot;yes&quot;  GenericWrite =&quot;yes&quot;    WriteAttributes=&quot;yes&quot; ReadPermission =&quot;yes&quot;   ChangePermission=&quot;yes&quot;/&gt;
    &lt;/CreateFolder&gt;
&lt;/Component&gt;
</code></pre><h4 id="建立-windows-menu-資料">建立 Windows Menu 資料</h4>
<p>可以 Windows Menu 啟動檔案跟卸載執行檔。</p>
<p>需要注意一些細項設定，如 Guid、執行檔名稱、路徑等。</p>
<pre tabindex="0"><code class="language-wxc" data-lang="wxc">&lt;Directory Id=&quot;ProgramMenuFolder&quot;&gt;
    &lt;Directory Id=&quot;ApplicationProgramsFolder&quot; Name=&quot;Wix-Hello Unity&quot;&gt;
        &lt;Component Id=&quot;ApplicationShortcut&quot; Guid=&quot;{9724BE7E-7132-4978-B806-4B0D1B3DE350}&quot;&gt;
            &lt;Shortcut Id=&quot;ApplicationStartMenuShortcut&quot;
                    Name=&quot;Wix-Hello Unity&quot;
                    Description=&quot;Wix-Hello Unity&quot;
                    Target=&quot;[INSTALLFOLDER]\Wix-Hello Unity.exe&quot;
                    WorkingDirectory=&quot;APPLICATIONROOTDIRECTORY&quot;
                    Icon=&quot;WixToolsetIcon&quot;/&gt;
            &lt;Shortcut Id=&quot;UninstallProduct&quot;
                    Name=&quot;Uninstall&quot;
                    Description=&quot;Uninstalls Wix-Hello Unity&quot;
                    Target=&quot;[System64Folder]msiexec.exe&quot;
                    Arguments=&quot;/x [ProductCode]&quot; /&gt;
            &lt;RemoveFolder Id=&quot;ProgramMenuSubfolder&quot; On=&quot;uninstall&quot;/&gt;
            &lt;RemoveFolder Id=&quot;ApplicationProgramsFolder&quot; On=&quot;uninstall&quot;/&gt;

            &lt;RegistryValue Root=&quot;HKCU&quot; Key=&quot;Software\WenRongStudio\Wix-Hello Unity&quot; Name=&quot;installed&quot; Type=&quot;integer&quot; Value=&quot;1&quot; KeyPath=&quot;yes&quot;/&gt;
        &lt;/Component&gt;
    &lt;/Directory&gt;
&lt;/Directory&gt;
</code></pre><h3 id="githubgithub"><a href="https://github.com/Wenrong274/WixExamples">GitHub</a></h3>
<h3 id="參考文章">參考文章</h3>
<p><a href="https://blog.walterlv.com/post/getting-started-with-wix-toolset-msi-hello-world">用 WiX 制作安装包：创建一个简单的 msi 安装包</a></p>
<p><a href="https://ithelp.ithome.com.tw/users/20139206/ironman/3901">30 天 | C# WixToolset + WPF 帥到不行的安裝包 系列</a></p>
<p><a href="https://wixtoolset.org/docs/v3/howtos/files_and_registry/create_uninstall_shortcut/">Create an Uninstall Shortcut</a></p>
<p><a href="https://wixtoolset.org/docs/v3/howtos/files_and_registry/create_start_menu_shortcut/">Create a Shortcut on the Start Menu</a></p>
<p><a href="https://stackoverflow.com/a/17513551">Removing files when uninstalling WiX</a></p>
<hr>
]]></content:encoded>
    </item>
    
    <item>
      <title>Example Inno Setup</title>
      <link>https://wenrongdev.com/posts/example-inno-setup/</link>
      <pubDate>Thu, 19 Dec 2019 00:00:00 +0000</pubDate>
      
      <guid>https://wenrongdev.com/posts/example-inno-setup/</guid>
      <description>簡易使用 Inno Setup 打包教學。</description>
      <content:encoded><![CDATA[<h2 id="install">Install</h2>
<p>去官網下載 <a href="http://www.jrsoftware.org/isinfo.php">Inno Setup</a>，請下載 <strong>Stable Release</strong> 版本。</p>
<h2 id="add-language">Add Language</h2>
<ol>
<li>下載官方提供的 <a href="https://github.com/jrsoftware/issrc">Github</a>，直接下載 <strong>Releases</strong> 版本，完成後解壓縮。</li>
<li>複製 <code>root/Files/Languages</code> 資料夾，貼上並且覆蓋 <strong>Inno Setup 安裝資料夾</strong>。<img loading="lazy" src="https://imgur.com/3gD0X18.jpg" alt="img_1"  />
</li>
</ol>
<h2 id="使用方式">使用方式</h2>
<p>可以參考以下腳本，也可以自己寫，不知道寫法可以參考<a href="http://www.jrsoftware.org/ishelp/">官方文件</a>。</p>
<pre tabindex="0"><code class="language-Pascal" data-lang="Pascal">
#define MyAppGUID &quot;{{D0D7EBDD-2493-4086-A306-AB012D2AFA93}&quot;
#define MyAppName &quot;Examle&quot;
#define MyAppFolder &quot;ExampleFolder&quot;
#define MyAppSetupExeName &quot;Examle&quot;

#define MyAppExeName &quot;Examle.exe&quot;
#define MyAppURL &quot;https://wenrongdev.com/&quot;
#define MyAppPublisher &quot;wen rong studio&quot;

[Setup]
AppId={#MyAppGUID}
AppName={#MyAppName}
AppVersion=0.1.0
AppVerName={#MyAppName}
AppPublisher = {#MyAppPublisher}
AppPublisherURL = {#MyAppURL}
AppSupportURL = {#MyAppURL}
AppUpdatesURL = {#MyAppURL}
Compression = lzma2
DefaultDirName={commonpf32}\{#MyAppFolder}
DisableProgramGroupPage=yes
DefaultGroupName={#MyAppName}
UninstallDisplayIcon={app}ForwardSlash{#MyAppExeName}
SolidCompression = no
OutputDir = &quot;Setup&quot;
OutputBaseFilename = {#MyAppSetupExeName}
ShowLanguageDialog=yes

// 是否需要分割
DiskSpanning=yes
SlicesPerDisk=3
DiskSliceSize=1566000000
///

[Languages]
Name: EN; MessagesFile: &quot;compiler:Default.isl&quot;
Name: CT; MessagesFile: &quot;compiler:Languages\Unofficial\ChineseTraditional.isl&quot;
Name: CS; MessagesFile: &quot;compiler:Languages\Unofficial\ChineseSimplified.isl&quot;
Name: JP; MessagesFile: &quot;compiler:Languages\Japanese.isl&quot;

[CustomMessages]
MyAppName = {#MyAppName}
MyAppVerName = {#MyAppName} %1

[Messages]
BeveledLabel = {#MyAppURL}

[Dirs]
Name: &quot;{app}&quot;; Permissions: everyone-full

[Files]
Source: &quot;{#MyAppFolder}\*&quot;; DestDir: &quot;{app}\{#MyAppFolder}&quot;; Flags: ignoreversion recursesubdirs

[Icons]
Name: &quot;{userdesktop}\{cm:MyAppName}&quot;; Filename: &quot;{app}\{#MyAppFolder}\{#MyAppExeName}&quot;;

[Code]
function GetNumber(var temp: String): Integer;
var
  part: String;
  pos1: Integer;
begin
  if Length(temp) = 0 then
  begin
    Result := -1;
    Exit;
  end;
    pos1 := Pos('.', temp);
    if (pos1 = 0) then
    begin
      Result := StrToInt(temp);
    temp := '';
    end
    else
    begin
    part := Copy(temp, 1, pos1 - 1);
      temp := Copy(temp, pos1 + 1, Length(temp));
      Result := StrToInt(part);
    end;
end;

function CompareInner(var temp1, temp2: String): Integer;
var
  num1, num2: Integer;
begin
    num1 := GetNumber(temp1);
  num2 := GetNumber(temp2);
  if (num1 = -1) or (num2 = -1) then
  begin
    Result := 0;
    Exit;
  end;
      if (num1 &gt; num2) then
      begin
        Result := 1;
      end
      else if (num1 &lt; num2) then
      begin
        Result := -1;
      end
      else
      begin
        Result := CompareInner(temp1, temp2);
      end;
end;

function CompareVersion(str1, str2: String): Integer;
var
  temp1, temp2: String;
begin
    temp1 := str1;
    temp2 := str2;
    Result := CompareInner(temp1, temp2);
end;

function InitializeSetup(): Boolean;
var
  oldVersion: String;
  uninstaller: String;
  ErrorCode: Integer;
  vCurID      :String;
  vCurAppName :String;
begin
  vCurID:= '{#SetupSetting(&quot;AppId&quot;)}';
  vCurAppName:= '{#SetupSetting(&quot;AppName&quot;)}';
  vCurID:= Copy(vCurID, 2, Length(vCurID) - 1);

  if RegKeyExists(HKEY_LOCAL_MACHINE,
    'SOFTWARE\Microsoft\Windows\CurrentVersion\Uninstall\' + vCurID + '_is1') then
  begin
    RegQueryStringValue(HKEY_LOCAL_MACHINE,
      'SOFTWARE\Microsoft\Windows\CurrentVersion\Uninstall\' + vCurID + '_is1',
      'DisplayVersion', oldVersion);
    if (CompareVersion(oldVersion, '{#SetupSetting(&quot;AppVersion&quot;)}') &lt; 0) then
    begin
      if MsgBox('Version ' + oldVersion + ' of ' + vCurAppName + ' is already installed. Continue to use this old version?',
        mbConfirmation, MB_YESNO) = IDYES then
      begin
        Result := False;
      end
      else
      begin
          RegQueryStringValue(HKEY_LOCAL_MACHINE,
            'SOFTWARE\Microsoft\Windows\CurrentVersion\Uninstall\' + vCurID + '_is1',
            'UninstallString', uninstaller);
          ShellExec('runas', uninstaller, '/SILENT', '', SW_HIDE, ewWaitUntilTerminated, ErrorCode);
          Result := True;
      end;
    end
    else
    begin
      MsgBox('Version ' + oldVersion + ' of ' + vCurAppName + ' is already installed. This installer will exit.',
        mbInformation, MB_OK);
      Result := False;
    end;
  end
  else
  begin
    Result := True;
  end;
end;

</code></pre><h2 id="修改方式">修改方式</h2>
<p>假如是使用複製舊有的 <code>.iss 檔</code>，只需要修改幾個需要注意的文字即可。</p>
<p>正常的資料夾結構</p>
<table>
<thead>
<tr>
<th style="text-align:left">Folder</th>
<th style="text-align:left">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">ExampleFolder</td>
<td style="text-align:left">打包前的資料夾</td>
</tr>
<tr>
<td style="text-align:left">Setup</td>
<td style="text-align:left">Inno Setup 輸出的資料夾</td>
</tr>
<tr>
<td style="text-align:left">.iss</td>
<td style="text-align:left">Inno Setup Script</td>
</tr>
</tbody>
</table>
<p><img loading="lazy" src="https://imgur.com/AXDhz5x.jpg" alt="img_2"  />
</p>
<h3 id="修改-iss">修改 .iss</h3>
<pre tabindex="0"><code class="language-Pascal" data-lang="Pascal">#define MyAppGUID &quot;GUID&quot;
#define MyAppName &quot;Examle&quot;
#define MyAppFolder &quot;ExampleFolder&quot;
#define MyAppSetupExeName &quot;Examle&quot;
#define MyAppExeName &quot;Examle.exe&quot;
#define MyAppURL &quot;https://wenrongdev.com/&quot;
#define MyAppPublisher &quot;wen rong studio&quot;
</code></pre><h3 id="需修改地方">需修改地方</h3>
<table>
<thead>
<tr>
<th style="text-align:left">Arg</th>
<th style="text-align:left">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">MyAppGUID</td>
<td style="text-align:left">安裝系統 GUID，產生方式為 <code>Tools/Generated GUID</code>。</td>
</tr>
<tr>
<td style="text-align:left">MyAppName</td>
<td style="text-align:left">桌面路徑名稱 。</td>
</tr>
<tr>
<td style="text-align:left">MyAppFolder</td>
<td style="text-align:left">安裝目錄名稱。</td>
</tr>
<tr>
<td style="text-align:left">MyAppSetupExeName</td>
<td style="text-align:left">Inno Setup 輸出安裝檔名稱 。</td>
</tr>
</tbody>
</table>
<h4 id="取得-guid-方法">取得 GUID 方法</h4>
<p><img loading="lazy" src="https://imgur.com/d05PwU1.jpg" alt="img_3"  />
</p>
<h2 id="githubhttpsgithubcomwenrong274exampleinnosetup"><a href="https://github.com/Wenrong274/ExampleInnoSetup">Github</a></h2>
<hr>
]]></content:encoded>
    </item>
    
  </channel>
</rss>
